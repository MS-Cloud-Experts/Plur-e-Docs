### **Proceso de Join (Unión) de License Plates (LP)**

**Objetivo:**  
El proceso de Join (Unión) de License Plates (LP) permite combinar varios LPs en uno solo, consolidando las cantidades y ubicaciones de los ítems. Este proceso es esencial para optimizar el espacio de almacenamiento, simplificar la gestión del inventario y facilitar la preparación de kits o paquetes con diferentes ítems.

---

### **Escenarios del Proceso de Join**

#### **Escenario 1: Unión de Múltiples LPs en un Nuevo LP**

**Caso 1.1:**

- **Descripción:**
  - Los LPs seleccionados (LP001 y LP002) pueden contener diferentes Item No., Variant Code, y Unit of Measure. Además, pueden tener LPs hijos asociados. El usuario desea consolidar las cantidades y los ítems de estos LPs, junto con sus LPs hijos, en un nuevo LP (LP003).

- **Acción:**
  - El sistema permite la unión de los LPs seleccionados, transfiriendo las cantidades y los ítems de LP001 y LP002, junto con sus LPs hijos, a un nuevo LP (LP003). Los LPs originales (LP001 y LP002) y sus relaciones con LPs hijos se marcan como "Joined" y se inutilizan para futuras operaciones.

- **Regla:**
  - Los LPs originales y sus LPs hijos se reasignan al nuevo LP y se marcan como "Joined", evitando su reutilización en otras operaciones.
  - Se deben registrar movimientos en la tabla "PLU LP Movements" para cada cambio de cantidad, ítem, y de asignación de LPs hijos, asegurando la trazabilidad e integridad de los datos.

- **Ejemplo:**
  - **Estado Inicial:**
    - LP001 tiene 50 unidades del Item A y un LP hijo LP101.
    - LP002 tiene 70 unidades del Item B y un LP hijo LP102.
  - **Solicitud de Join:**
    - Consolidar LP001 y LP002 en un nuevo LP, LP003, moviendo también LP101 y LP102.
  - **Resultado:**
    - LP003 se crea con 50 unidades del Item A y 70 unidades del Item B, y hereda LP101 y LP102 como LPs hijos.
    - LP001 y LP002 se marcan como "Joined".
    - Los movimientos correspondientes se registran en la tabla "PLU LP Movements".

---

#### **Escenario 2: Unión de Múltiples LPs en un LP Existente**

**Caso 2.1:**

- **Descripción:**
  - El usuario selecciona varios LPs (LP004 y LP005) que pueden contener diferentes Item No., Variant Code, y Unit of Measure, y pueden tener LPs hijos asociados. El objetivo es consolidar sus cantidades, ítems, y LPs hijos en un LP ya existente (LP006).

- **Acción:**
  - El sistema permite la unión de los LPs seleccionados, transfiriendo las cantidades y los ítems de LP004 y LP005, junto con sus LPs hijos, a LP006. Los LPs originales (LP004 y LP005) se marcan como "Joined" y se inutilizan para futuras operaciones.

- **Regla:**
  - Los LPs originales y sus LPs hijos se reasignan al LP existente y se marcan como "Joined", evitando su reutilización en otras operaciones.
  - Se deben registrar movimientos en la tabla "PLU LP Movements" para cada cambio de cantidad, ítem, y de asignación de LPs hijos, asegurando la trazabilidad e integridad de los datos.

- **Ejemplo:**
  - **Estado Inicial:**
    - LP004 tiene 30 unidades del Item C y un LP hijo LP103.
    - LP005 tiene 50 unidades del Item D y un LP hijo LP104.
    - LP006 tiene 20 unidades del Item E y un LP hijo LP105.
  - **Solicitud de Join:**
    - Consolidar LP004 y LP005 en LP006, moviendo también LP103 y LP104.
  - **Resultado:**
    - LP006 ahora contiene 30 unidades del Item C, 50 unidades del Item D, y 20 unidades del Item E, y hereda LP103 y LP104 como LPs hijos.
    - LP004 y LP005 se marcan como "Joined".
    - Los movimientos correspondientes se registran en la tabla "PLU LP Movements".

---

### **Reglas Generales y Restricciones:**

1. **Consistencia de Atributos (Opcional):**
   - Aunque se permite la unión de LPs con diferentes Item No., Variant Code, y Unit of Measure, se recomienda que los LPs sean lo más consistentes posible para facilitar la gestión del inventario. Esta regla es flexible y depende de las necesidades específicas de la operación.

2. **Manejo del Estado de los LPs:**
   - Los LPs originales y sus LPs hijos se marcan como "Joined" después de la unión, y ya no pueden ser utilizados en otras operaciones.

3. **Integridad del Inventario:**
   - El sistema debe asegurar que las cantidades totales y los ítems en el LP de destino reflejen correctamente la suma de las cantidades e ítems unidas de los LPs originales y que los LPs hijos sean correctamente reasignados.

4. **Reasignación de LPs Hijos:**
   - Si los LPs originales tienen LPs hijos, estos deben ser reasignados al LP de destino, asegurando que todas las relaciones jerárquicas se mantengan.

5. **Registro de Movimientos:**
   - Todos los movimientos de cantidades, ítems, y reasignaciones de LPs hijos deben registrarse en la tabla "PLU LP Movements" para mantener una trazabilidad completa y garantizar la integridad de los datos.

---

### **Consideraciones Adicionales:**

- **Auditoría y Trazabilidad:**
  - El proceso de unión debe ser completamente trazable, con registros detallados de los movimientos y cambios de estado en el inventario.

- **Compatibilidad de Estados:**
  - Solo se pueden unir LPs que estén en estados que permitan la consolidación, como "Stored" o "Received". Los LPs en estados "Blocked" o "Reserved" deben ser excluidos del proceso.

- **Reversibilidad del Proceso:**
  - Se debe considerar la implementación de un mecanismo que permita deshacer la unión en caso de errores detectados después de completado el proceso.

---

### **Resumen:**
Estos escenarios permiten la unión de LPs con diferentes ítems y variantes en un solo LP, ya sea nuevo o existente. Esto proporciona flexibilidad para consolidar inventarios en situaciones donde se necesita formar kits o simplificar la logística. Además, se asegura que todos los movimientos sean registrados para mantener la integridad y trazabilidad del inventario.
