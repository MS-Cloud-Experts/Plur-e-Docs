# **Warehouse Item Journal: Conteo Físico de Inventario con License Plates (LPs)**

## **1. Introducción**

El proceso de manejo de License Plates (LPs) en Business Central es esencial para la correcta gestión y trazabilidad del inventario en el almacén. Esta API, **Get_WarehouseInvPhysicalCount_LP**, está diseñada para obtener el conteo físico de inventario asociado con los License Plates, basándose en las líneas del Warehouse Journal. Este documento explica el funcionamiento, las entradas y salidas, y los procesos clave que realiza la API.

## **2. Conceptos Clave**

### **2.1 License Plates (LPs)**
Un **License Plate (LP)** es un identificador único asignado a un grupo de ítems en el almacén, facilitando su seguimiento y gestión dentro de Business Central. Los LPs pueden contener información importante como el número de serie, lote, fecha de expiración, y otros detalles críticos del producto.

### **2.2 Warehouse Journal**
El **Warehouse Journal** es una herramienta dentro de Business Central utilizada para registrar transacciones de inventario, como ajustes o transferencias. En este caso, se emplea para registrar el conteo físico de los LPs dentro del almacén.

### **2.3 Jerarquía de LPs**
Cada LP puede tener relaciones jerárquicas, es decir, un LP padre puede contener múltiples LPs hijos, y la API es capaz de navegar estas relaciones y presentar la jerarquía completa de LPs.

## **3. Procesos**

### **3.1 Obtención del Conteo Físico de License Plates a través de la API**

#### **3.1.1 Descripción del Proceso**
El proceso de obtención del conteo físico de los LPs implica recibir un JSON con los parámetros del Journal y devolver un array en formato JSON que contiene la información de las líneas del Warehouse Journal y la jerarquía completa de LPs asociados.

#### **3.1.2 Pasos del Proceso**
1. **Recepción de Parámetros (JournalTemplateName, JournalBatchName, LocationCode):**
   - La API recibe los parámetros en formato JSON, que incluyen el nombre de la plantilla del journal, el nombre del batch, y el código de la ubicación (LocationCode).

2. **Filtrado de las Líneas del Warehouse Journal:**
   - Se filtran las líneas del Warehouse Journal basándose en la configuración de **PLU Inventory Counting** y los parámetros proporcionados. Dependiendo de la configuración, se filtran LPs que son gestionados o no por el sistema Plur-e.

3. **Recolectar LPs y su Jerarquía:**
   - La API obtiene los LPs que están relacionados con las líneas filtradas del Warehouse Journal y construye su jerarquía completa, incluyendo las relaciones padre-hijo.

4. **Generación de la Estructura JSON:**
   - Se genera un objeto JSON que contiene toda la información de las líneas del Warehouse Journal, incluyendo los detalles del LP, cantidades, ubicaciones, y la jerarquía de LPs relacionados.

5. **Devolución del JSON:**
   - La API devuelve el conteo físico en formato JSON, listo para ser procesado o visualizado por el sistema o el usuario.

#### **3.1.3 Ventajas del Enfoque**
- **Trazabilidad Completa:** Se asegura de que todos los movimientos y relaciones de los LPs estén debidamente registrados y sean accesibles para auditoría o análisis posterior.
- **Escalabilidad:** Permite manejar inventarios de gran escala con múltiples LPs jerárquicos y procesos simultáneos, asegurando la integridad de los datos.
- **Integración Fluida:** La API puede ser utilizada tanto para la interfaz gráfica de Business Central como en procesos automáticos a través de integraciones externas.

### **3.2 Detalles Técnicos de la Jerarquía de LPs**

#### **3.2.1 Jerarquía de Parent-Child**
La API obtiene la jerarquía completa de un LP, incluyendo sus relaciones con otros LPs. Para cada LP, se puede identificar:
- **Super Parent LP:** El LP principal dentro de una jerarquía de LPs.
- **LPs Relacionados:** Todos los LPs hijos relacionados con el LP principal, lo que facilita el manejo de grandes volúmenes de inventario de forma organizada.

#### **3.2.2 Cálculo de Cantidades**
Cada LP contiene la cantidad total de ítems asociados. Además, la API calcula y devuelve las cantidades físicas de los ítems en los LPs para facilitar el conteo físico del inventario.

## **4. Consideraciones Técnicas**

### **4.1 Manejo de Errores**
- **Validación de Parámetros:** La API valida que los parámetros proporcionados (JournalTemplateName, JournalBatchName, LocationCode) sean correctos antes de proceder con el proceso.
- **Recuperación de Errores:** En caso de un error, como un LP no existente o una línea del journal no válida, se notifica al sistema con un mensaje adecuado para manejar el problema.

### **4.2 Optimización para API**
- **Estructura JSON Eficiente:** La API genera una estructura JSON que incluye solo la información necesaria para el conteo físico de inventario, lo que optimiza el uso de recursos.
- **Manejo Asíncrono:** El diseño de la API permite que se pueda integrar en procesos asíncronos, donde los resultados se devuelven cuando el sistema ha procesado toda la información de los LPs.

## **5. Resumen**

La API **Get_WarehouseInvPhysicalCount_LP** está diseñada para obtener y procesar el conteo físico de inventario relacionado con License Plates (LPs) en Business Central. Este proceso asegura una trazabilidad completa, la correcta administración de las jerarquías de LPs, y una gestión eficiente del inventario a gran escala. Con un enfoque robusto y escalable, esta API optimiza la gestión de inventarios para garantizar que los LPs estén correctamente registrados y que se puedan procesar grandes volúmenes de datos de manera eficiente.

[[_TOSP_]]
